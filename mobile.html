<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jeju Mobile Weather</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body {
            margin: 0; padding: 10px; background-color: #222;
            display: flex; flex-direction: column; align-items: center;
            font-family: 'Noto Sans SC', sans-serif; min-height: 100vh; color: #333;
        }
        .dashboard-container {
            display: flex; flex-direction: column; width: 100%; max-width: 600px; gap: 15px; padding-bottom: 30px;
        }
        .capture-card {
            width: 100%; background: #fff; border-radius: 12px; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); display: flex; flex-direction: column;
            margin-bottom: 5px;
        }
        .card-header-top {
            background: #eee; padding: 10px; font-weight: 800; font-size: 14px;
            text-align: center; color: #555; border-bottom: 1px solid #ddd;
        }
        #card-cctv { background: #000; border: 1px solid #333; }
        .cctv-header { padding: 10px; background: linear-gradient(90deg, #d32f2f, #f57c00); color: white; text-align: center; font-size: 16px; font-weight: 900; }
        .cctv-content { display: flex; flex-direction: column; gap: 1px; background: #111; }
        .video-container { width: 100%; aspect-ratio: 16/9; position: relative; background: #000; }
        .tag { position: absolute; top: 10px; left: 10px; background: red; color: white; padding: 2px 6px; font-weight: bold; border-radius: 3px; font-size: 10px; z-index: 20; animation: blink 2s infinite; }
        .label { position: absolute; bottom: 8px; left: 10px; text-shadow: 1px 1px 3px rgba(0,0,0,1); color: #fff; font-size: 14px; font-weight: 800; z-index: 10; }
        video { width: 100%; height: 100%; object-fit: cover; }
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.7;} 100% {opacity: 1;} }

        .loc-section { padding: 15px 10px; border-bottom: 1px solid #eee; }
        .loc-section:last-child { border-bottom: none; }
        .loc-title { font-size: 16px; font-weight: 900; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 10px; background: #e3f2fd; color: #1565c0; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        .w-grid { display: flex; flex-wrap: wrap; justify-content: flex-start; gap: 0; }
        .w-col {
            width: 14.2%; display: flex; flex-direction: column; align-items: center;
            margin-bottom: 10px;
        }
        .weekly-grid .w-col { width: 25%; margin-bottom: 15px; }

        .f-time { font-size: 10px; color: #888; font-weight: 700; margin-bottom: 2px; }
        .f-icon { font-size: 18px; margin-bottom: 0px; }
        .f-temp { font-size: 12px; font-weight: 800; color: #000; margin-bottom: 1px; }
        .f-wind { font-size: 9px; color: #1565c0; font-weight: 600; transform: scale(0.9); } /* ÌíçÏÜç Ï∂îÍ∞Ä */
        .t-high { color: #d32f2f; } .t-low { color: #1976d2; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div id="card-cctv" class="capture-card">
            <div class="cctv-header">üî¥ JEJU LIVE CCTV</div>
            <div class="cctv-content">
                <div class="video-container"><div class="tag">LIVE</div><div class="label">üèùÔ∏è UDO (Ïö∞ÎèÑ)</div><video id="v1" autoplay muted playsinline></video></div>
                <div class="video-container"><div class="tag">LIVE</div><div class="label">üèîÔ∏è HALLA (ÌïúÎùºÏÇ∞)</div><video id="v2" autoplay muted playsinline></video></div>
                <div class="video-container"><div class="tag">LIVE</div><div class="label">üõ£Ô∏è 1100 ROAD</div><video id="v3" autoplay muted playsinline></video></div>
            </div>
        </div>

        <div class="capture-card">
            <div class="card-header-top">‚òÄÔ∏è Ïò§Îäò (Ï£ºÏöî ÎèÑÏã¨)</div>
            <div id="daily-group-1" style="min-height:100px; display:flex; justify-content:center; align-items:center;">Loading...</div>
        </div>

        <div class="capture-card">
            <div class="card-header-top">üèîÔ∏è Ïò§Îäò (Í¥ÄÍ¥ëÏßÄ)</div>
            <div id="daily-group-2" style="min-height:100px; display:flex; justify-content:center; align-items:center;">Loading...</div>
        </div>

        <div class="capture-card">
            <div class="card-header-top">üìÖ Ï£ºÍ∞Ñ ÏòàÎ≥¥ (3Ïùº~10ÏùºÌõÑ)</div>
            <div id="weekly-list" style="padding:10px; min-height:100px;">Loading...</div>
        </div>
    </div>

<script>
    const API_KEY = '05988a053767a7a6cc5553d077ce7ea541c60806a0160d5ac2e9119ebe5a61ce';
    // ÌîÑÎ°ùÏãú Î≥ÄÍ≤Ω (ÏïàÏ†ïÏÑ± ÌôïÎ≥¥)
    const PROXY = 'https://api.allorigins.win/raw?url=';
    const now = new Date();
    const todayStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;

    function initCCTV() {
        const streams = [
            { id: 'v1', url: 'http://211.114.96.121:1935/jejusi7/11-24.stream/chunklist_w1514884533.m3u8' },
            { id: 'v2', url: 'http://119.65.216.155:1935/live/cctv03.stream_360p/chunklist_w324217178.m3u8' },
            { id: 'v3', url: 'http://119.65.216.155:1935/live/cctv05.stream_360p/chunklist_w1064037964.m3u8' }
        ];
        if (Hls.isSupported()) {
            streams.forEach(s => {
                const v = document.getElementById(s.id);
                const h = new Hls(); h.loadSource(s.url); h.attachMedia(v);
                h.on(Hls.Events.ERROR, function(e,d){ if(d.fatal) h.startLoad(); });
            });
        }
    }

    async function initDailyWeather() {
        const locs1 = [{n:"Ï†úÏ£ºÏãú",x:52,y:38}, {n:"ÏÑúÍ∑ÄÌè¨",x:52,y:32}];
        const locs2 = [{n:"ÌïúÎùºÏÇ∞",x:52,y:35}, {n:"Ïö∞ÎèÑ",x:60,y:38}];
        const baseTime = now.getHours() < 2 ? "2300" : "0200";
        const baseDate = now.getHours() < 2 ? String(Number(todayStr)-1) : todayStr;

        async function fetchAndRender(locs, divId) {
            const container = document.getElementById(divId);
            container.innerHTML = '';

            for (const loc of locs) {
                let html = '';
                try {
                    // encodeURIComponentÎ°ú URL Í∞êÏã∏Í∏∞ (ÏÉà ÌîÑÎ°ùÏãú Í∑úÏπô)
                    const targetUrl = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${API_KEY}&numOfRows=300&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${loc.x}&ny=${loc.y}`;
                    const res = await fetch(PROXY + encodeURIComponent(targetUrl));
                    const json = await res.json();

                    const hourly = {};
                    json.response.body.items.item.forEach(i => {
                        if (i.fcstDate === todayStr) {
                            const h = parseInt(i.fcstTime.slice(0,2));
                            if (h >= 9 && h <= 22) {
                                if(!hourly[h]) hourly[h] = {};
                                hourly[h][i.category] = i.fcstValue;
                            }
                        }
                    });

                    for(let h=9; h<=22; h++) {
                        const d = hourly[h];
                        if(d) {
                            let icon = '‚òÄÔ∏è';
                            const pty = parseInt(d.PTY||0), sky = parseInt(d.SKY||1);
                            if(pty>0) icon=(pty===3)?'‚ùÑÔ∏è':'üåßÔ∏è'; else if(sky>5) icon='‚òÅÔ∏è'; else if(sky>8) icon='‚õÖ';

                            // ÌíçÏÜç(WSD) Ï∂îÍ∞Ä
                            html += `<div class="w-col">
                                <div class="f-time">${h}Ïãú</div>
                                <div class="f-icon">${icon}</div>
                                <div class="f-temp">${d.TMP}¬∞</div>
                                <div class="f-wind">${d.WSD}m/s</div>
                            </div>`;
                        }
                    }
                } catch(e) { html = '<div style="color:red; font-size:12px;">Data Error</div>'; }

                container.innerHTML += `<div class="loc-section"><div class="loc-title">${loc.n} <span class="badge">09~22Ïãú</span></div><div class="w-grid">${html}</div></div>`;
            }
        }
        await fetchAndRender(locs1, 'daily-group-1');
        await fetchAndRender(locs2, 'daily-group-2');
    }

    async function initWeeklyWeather() {
        const container = document.getElementById('weekly-list');
        const locs = [{ name: "Ï†úÏ£ºÏãú", regIdTemp: '11G00201', regIdLand: '11G00000' }];

        const h = now.getHours();
        let midTmFc, dayShift = 0;
        if (h < 6) {
            const yD = new Date(now); yD.setDate(now.getDate() - 1);
            midTmFc = `${yD.getFullYear()}${String(yD.getMonth()+1).padStart(2,'0')}${String(yD.getDate()).padStart(2,'0')}1800`;
            dayShift = 1;
        } else if (h >= 18) { midTmFc = `${todayStr}1800`; }
        else { midTmFc = `${todayStr}0600`; }

        container.innerHTML = '';
        for (const loc of locs) {
            try {
                const urlT = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidTa?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdTemp}&tmFc=${midTmFc}`;
                const resT = await fetch(PROXY + encodeURIComponent(urlT)); const jsonT = await resT.json();

                const urlL = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidLandFcst?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdLand}&tmFc=${midTmFc}`;
                const resL = await fetch(PROXY + encodeURIComponent(urlL)); const jsonL = await resL.json();

                if(jsonT.response.header.resultCode === '00') {
                    const t = jsonT.response.body.items.item[0];
                    const l = jsonL.response.body.items.item[0];
                    let html = '';

                    for(let i=3; i<=10; i++) {
                        const k = i + dayShift; if(k>10) continue;
                        const d = new Date(now); d.setDate(now.getDate() + i);
                        const label = `${d.getMonth()+1}/${d.getDate()}`;

                        let wf = (k<=7) ? (l[`wf${k}Pm`]||l[`wf${k}`]) : l[`wf${k}`];
                        let icon = '‚òÄÔ∏è';
                        if(wf && wf.includes('ÎπÑ')) icon='üåßÔ∏è'; else if(wf && wf.includes('Íµ¨Î¶Ñ')) icon='‚òÅÔ∏è';

                        const min = t[`taMin${k}`]||t[`taMin${k}Low`];
                        const max = t[`taMax${k}`]||t[`taMax${k}High`];

                        html += `<div class="w-col"><div class="f-time">${label}</div><div class="f-icon">${icon}</div><div class="f-temp"><span class="t-high">${max}</span>/<span class="t-low">${min}</span></div></div>`;
                    }
                    container.innerHTML += `<div class="loc-section"><div class="loc-title">Ï†úÏ£º Ï†ÑÏó≠ <span class="badge">3Ïùº~10ÏùºÌõÑ</span></div><div class="w-grid weekly-grid">${html}</div></div>`;
                }
            } catch(e) {}
        }
    }

    initCCTV();
    initDailyWeather();
    setTimeout(initWeeklyWeather, 1500);
</script>
</body>
</html>
