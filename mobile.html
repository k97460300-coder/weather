<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµå·å²›å¤©æ°” - é™æ°´é‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            margin: 0; background-color: #f0f2f5;
            display: flex; flex-direction: row;
            font-family: 'Noto Sans SC', sans-serif;
            width: 100vw;
            height: 100%;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .container {
             display: flex; flex-direction: row; height: 100%;
             width: 600vw; /* 6 cards */
        }
        .card {
            flex: 0 0 100vw;
            scroll-snap-align: start;
            height: 100vh;
            box-sizing: border-box;
            padding: 10px;
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack header and content vertically */
        }
        .card-inner {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Important to contain children */
        }
        .card-header {
            background: #fff; padding: 12px 15px; border-bottom: 1px solid #eee;
            font-weight: 800; font-size: 16px; color: #1a1a1a; display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0; /* Prevent header from shrinking */
        }
        .card-content {
            flex-grow: 1; /* Allow content to fill available space */
            overflow-y: auto; /* Allow scrolling within the content area if needed */
            padding: 5px;
        }
        .badge { font-size: 11px; padding: 3px 8px; border-radius: 12px; background: #e8f5e9; color: #2e7d32; font-weight: bold; }

        /* CCTV Section */
        .video-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-bottom: 1px solid #222; cursor: pointer; }
        .live-tag { position: absolute; top: 10px; left: 10px; background: #ff5252; color: white; padding: 2px 6px; font-size: 10px; border-radius: 3px; z-index: 10; animation: blink 1.5s infinite; font-weight: bold; }
        .vid-label { position: absolute; bottom: 8px; left: 10px; color: white; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); z-index: 10; }
        video { width: 100%; height: 100%; object-fit: cover; }
        @keyframes blink { 0%, 100% {opacity: 1;} 50% {opacity: 0.6;} }

        /* Weather Section */
        .weather-section { padding: 15px 10px; border-bottom: 8px solid #f0f2f5; }
        .weather-section:last-child { border-bottom: none; }
        .loc-info { margin-bottom: 12px; }
        .loc-name { font-size: 18px; font-weight: 900; color: #1a1a1a; }
        .loc-sub { font-size: 12px; color: #666; margin-left: 5px; font-weight: 500; }

        .grid { display: flex; flex-wrap: wrap; gap: 0; }
        .col { width: 14.28%; display: flex; flex-direction: column; align-items: center; margin-bottom: 12px; }
        .weekly-grid .col { width: 14.28%; margin-bottom: 18px; }

        .time { font-size: 11px; color: #757575; font-weight: bold; margin-bottom: 3px; }
        .icon { font-size: 22px; margin-bottom: 2px; }
        .temp { font-size: 14px; font-weight: 900; color: #212121; }
        .wind { font-size: 9px; color: #0288d1; font-weight: 600; margin-top: 1px; }
        .precip { font-size: 10px; color: #546e7a; font-weight: 500; }
        .high { color: #d32f2f; } .low { color: #1976d2; }
        .precip-blue { color: #1e88e5; font-weight: bold; }

        footer { text-align: center; padding: 20px 10px; font-size: 11px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Card 1: CCTV -->
        <div class="card">
            <div class="card-inner" style="background:#000;">
                <div class="card-header" style="background:#ff5252; color:#fff; border:none;">ğŸ”´ æµå·å²›å®å†µ (Live CCTV)</div>
                <div class="card-content">
                    <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸï¸ ç‰›å²› (Udo - å¤©æ´¥æ¸¯)</div><video id="v1" autoplay muted playsinline></video></div>
                    <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸ”ï¸ æ±‰æ‹¿å±± (Mt.Halla - å¨åŠ¿å²³)</div><video id="v2" autoplay muted playsinline></video></div>
                    <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸ›£ï¸ 1100é«˜åœ°é“è·¯ (1100 Road)</div><video id="v3" autoplay muted playsinline></video></div>
                </div>
            </div>
        </div>

        <!-- Card 2: Daily Forecast 1/2 -->
        <div class="card">
            <div class="card-inner">
                <div class="card-header">â˜€ï¸ ä»Šæ—¥é€æ—¶é¢„æŠ¥ (1/2) <span class="badge" id="date-label"></span></div>
                <div class="card-content" id="daily-list-1">
                    <div style="padding:40px; text-align:center; color:#999; font-size:12px;">æ­£åœ¨è·å–å®æ—¶å¤©æ°”æ•°æ®...</div>
                </div>
            </div>
        </div>
        
        <!-- Card 3: Daily Forecast 2/2 -->
        <div class="card">
            <div class="card-inner">
                <div class="card-header">â˜€ï¸ ä»Šæ—¥é€æ—¶é¢„æŠ¥ (2/2) <span class="badge" id="date-label-2"></span></div>
                <div class="card-content" id="daily-list-2">
                    <div style="padding:40px; text-align:center; color:#999; font-size:12px;">æ­£åœ¨è·å–å®æ—¶å¤©æ°”æ•°æ®...</div>
                </div>
            </div>
        </div>

        <!-- Card 4: Weekly Forecast 1/2 -->
        <div class="card">
            <div class="card-inner">
                <div class="card-header">ğŸ“… æœªæ¥10å¤©é•¿æœŸé¢„æŠ¥ (1/2) <span class="badge" id="weekly-status-1">Updating</span></div>
                <div class="card-content" id="weekly-list-1">
                    <div style="padding:40px; text-align:center; color:#999; font-size:12px;">æ­£åœ¨è·å–é•¿æœŸé¢„æŠ¥æ•°æ®...</div>
                </div>
            </div>
        </div>
        
        <!-- Card 5: Weekly Forecast 2/2 -->
        <div class="card">
            <div class="card-inner">
                <div class="card-header">ğŸ“… æœªæ¥10å¤©é•¿æœŸé¢„æŠ¥ (2/2) <span class="badge" id="weekly-status-2">Updating</span></div>
                <div class="card-content" id="weekly-list-2">
                    <div style="padding:40px; text-align:center; color:#999; font-size:12px;">æ­£åœ¨è·å–é•¿æœŸé¢„æŠ¥æ•°æ®...</div>
                </div>
            </div>
        </div>
        
        <!-- Card 6: Hallasan Status -->
        <div class="card">
            <div class="card-inner">
                <div class="card-header">ğŸ”ï¸ æ±‰æ‹¿å±±æ¢è®¿è·¯æ§åˆ¶ä¿¡æ¯ <span class="badge" id="hallasan-status">Checking</span></div>
                <div class="card-content" id="hallasan-list">
                    <div style="padding:20px; text-align:center; color:#999; font-size:12px;">æ­£åœ¨è·å–å®æ—¶æ§åˆ¶ä¿¡æ¯...</div>
                </div>
                <footer>Data provided by Korea Meteorological Administration</footer>
            </div>
        </div>
    </div>
    
<script>
    function log(msg) { console.log(msg); }

    const MASTER_KEY = '05988a053767a7a6cc5553d077ce7ea541c60806a0160d5ac2e9119ebe5a61ce'; 
    const API_KEY = MASTER_KEY.trim(); 

    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth()+1).padStart(2,'0'); 
    const dd = String(now.getDate()).padStart(2,'0');
    const todayStr = yyyy + mm + dd;
    
    const dateText = (now.getMonth()+1) + 'æœˆ' + now.getDate() + 'æ—¥';
    document.getElementById('date-label').innerText = dateText;
    document.getElementById('date-label-2').innerText = dateText;

    function getFormatDate(date) {
        const y = date.getFullYear();
        const m = ('0' + (date.getMonth() + 1)).slice(-2);
        const d = ('0' + date.getDate()).slice(-2);
        return y + '' + m + '' + d;
    }

    async function initDaily() {
        const locs = [
            {n:"æµå·å¸‚ (è²æ´)", sub:"Yeon-dong", x:52, y:38},
            {n:"è¥¿å½’æµ¦ (ä¸­æ–‡)", sub:"Jungmun", x:52, y:32},
            {n:"æ±‰æ‹¿å±±", sub:"Mt.Halla", x:52, y:35},
            {n:"ç‰›å²›", sub:"Udo Island", x:60, y:38}
        ];
        
        let baseDate = todayStr;
        let baseTime = "0200";
        if (now.getHours() < 3) {
             const yD = new Date(yyyy, now.getMonth(), now.getDate() - 1);
             baseDate = getFormatDate(yD);
             baseTime = "2300";
        }

        const container1 = document.getElementById('daily-list-1');
        const container2 = document.getElementById('daily-list-2');
        container1.innerHTML = '';
        container2.innerHTML = '';

        for (const [index, loc] of locs.entries()) {
            const targetContainer = index < 2 ? container1 : container2;
            try {
                const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${API_KEY}&numOfRows=1000&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${loc.x}&ny=${loc.y}`;
                const res = await fetch(url);
                const json = await res.json();
                
                const hourly = {};
                if(json.response && json.response.header.resultCode === '00'){
                    json.response.body.items.item.forEach(i => {
                        if (i.fcstDate === todayStr) {
                            const h = parseInt(i.fcstTime.slice(0,2));
                            if(h>=9 && h<=22) {
                                if(!hourly[h]) hourly[h] = {};
                                hourly[h][i.category] = i.fcstValue;
                            }
                        }
                    });

                    let html = '';
                    for(let h=9; h<=22; h++) {
                        const d = hourly[h] || {};
                        let icon = 'â˜€ï¸';
                        const pty=parseInt(d.PTY||0), sky=parseInt(d.SKY||1);
                        if(pty>0) icon=(pty===3)?'â„ï¸':'ğŸŒ§ï¸'; else if(sky>8) icon='â˜ï¸'; else if(sky>5) icon='â›…';
                        if(h>=19 && (icon==='â˜€ï¸'||icon==='â›…')) icon='ğŸŒ™';

                        let pcp = d.PCP || '0';
                        if (pcp === "ê°•ìˆ˜ì—†ìŒ") pcp = "0mm";
                        else if (pcp.includes("ë¯¸ë§Œ")) pcp = "~1mm";
                        else if (!pcp.endsWith("mm")) pcp += "mm";

                        html += `<div class="col"><div class="time">${h}h</div><div class="icon">${icon}</div><div class="temp">${d.TMP||'-'}Â°</div><div class="wind">${d.WSD||'-'}m/s</div><div class="precip ${pcp!=='0mm'?'precip-blue':''}">${pcp}</div></div>`;
                    }
                    targetContainer.innerHTML += `<div class="weather-section"><div class="loc-info"><span class="loc-name">${loc.n}</span><span class="loc-sub">${loc.sub}</span></div><div class="grid">${html}</div></div>`;
                }
            } catch(e) { log('Daily Error: ' + e.message); }
        }
    }

    async function initWeekly() {
        const container1 = document.getElementById('weekly-list-1');
        const container2 = document.getElementById('weekly-list-2');
        const statusSpan1 = document.getElementById('weekly-status-1');
        const statusSpan2 = document.getElementById('weekly-status-2');
        container1.innerHTML = '';
        container2.innerHTML = '';
        
        const locs = [
            { name: "æµå·å¸‚", sub: "Jeju City", regIdTemp: '11G00201', regIdLand: '11G00000', nx:52, ny:38 },
            { name: "è¥¿å½’æµ¦", sub: "Seogwipo", regIdTemp: '11G00401', regIdLand: '11G00000', nx:52, ny:32 },
            { name: "æ±‰æ‹¿å±±", sub: "Mt.Halla", regIdTemp: '11G00401', regIdLand: '11G00000', nx:52, ny:35 },
            { name: "ç‰›å²›", sub: "Udo Island", regIdTemp: '11G00302', regIdLand: '11G00000', nx:60, ny:38 }
        ];

        let shortBaseDate = todayStr;
        let shortBaseTime = "0200";
        if (now.getHours() < 3) {
             const yD = new Date(yyyy, now.getMonth(), now.getDate() - 1);
             shortBaseDate = getFormatDate(yD);
             shortBaseTime = "2300";
        }

        const h = now.getHours();
        let midTmFc;
        if (h < 9) {
             const yD = new Date(yyyy, now.getMonth(), now.getDate() - 1);
             midTmFc = getFormatDate(yD) + '1800';
        } else if (h < 21) { 
             midTmFc = todayStr + '0600'; 
        } else { 
             midTmFc = todayStr + '1800'; 
        }

        for (const [index, loc] of locs.entries()) {
            const targetContainer = index < 2 ? container1 : container2;
            let combinedData = {};
            
            try {
                const urlS = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${API_KEY}&numOfRows=1000&pageNo=1&dataType=JSON&base_date=${shortBaseDate}&base_time=${shortBaseTime}&nx=${loc.nx}&ny=${loc.ny}`;
                const resS = await fetch(urlS); const jsonS = await resS.json();
                
                if(jsonS.response && jsonS.response.header.resultCode === '00'){
                    const tempDays = {};
                    jsonS.response.body.items.item.forEach(it => {
                        const date = it.fcstDate;
                        if(!tempDays[date]) tempDays[date] = { min:100, max:-100, sky:1, pty:0, pop:0, temps:[] };
                        if(it.category === 'TMN') tempDays[date].min = parseFloat(it.fcstValue);
                        if(it.category === 'TMX') tempDays[date].max = parseFloat(it.fcstValue);
                        if(it.category === 'TMP') tempDays[date].temps.push(parseFloat(it.fcstValue));
                        if(it.category === 'POP') tempDays[date].pop = Math.max(tempDays[date].pop, parseInt(it.fcstValue));
                        if(it.category === 'PTY') tempDays[date].pty = Math.max(tempDays[date].pty, parseInt(it.fcstValue));
                        if(it.category === 'SKY') tempDays[date].sky = parseInt(it.fcstValue); 
                    });
                    
                    for(let i=0; i<=3; i++){
                        const d = new Date(yyyy, now.getMonth(), now.getDate() + i);
                        const dStr = getFormatDate(d);
                        const t = tempDays[dStr];
                        if(t) {
                            if(t.min === 100 && t.temps.length > 0) t.min = Math.min(...t.temps);
                            if(t.max === -100 && t.temps.length > 0) t.max = Math.max(...t.temps);
                            let wf = "ë§‘ìŒ";
                            if(t.pty > 0) { if(t.pty===3) wf="ëˆˆ"; else wf="ë¹„"; } 
                            else { if(t.sky===3) wf="êµ¬ë¦„ë§ìŒ"; else if(t.sky===4) wf="íë¦¼"; }
                            combinedData[i] = { min: t.min, max: t.max, wf: wf, pop: t.pop };
                        }
                    }
                }
            } catch(e) { log('Short API Error: ' + e.message); }

            try {
                const urlT = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidTa?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdTemp}&tmFc=${midTmFc}`;
                const resT = await fetch(urlT); const jsonT = await resT.json();
                
                const urlL = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidLandFcst?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdLand}&tmFc=${midTmFc}`;
                const resL = await fetch(urlL); const jsonL = await resL.json();

                if(jsonT.response && jsonL.response && jsonT.response.header.resultCode === '00' && jsonL.response.header.resultCode === '00') {
                    const t = jsonT.response.body.items.item[0];
                    const l = jsonL.response.body.items.item[0];
                    
                    for(let i=4; i<=10; i++) {
                        let wf = l['wf'+i+'Pm'] || l['wf'+i+'Am'] || l['wf'+i] || (i===4 ? (l['wf3Pm'] || "ë§‘ìŒ") : "ë§‘ìŒ");
                        let pop = l['rnSt'+i+'Pm'] ?? l['rnSt'+i+'Am'] ?? l['rnSt'+i] ?? 0;
                        let minT = t['taMin'+i] ?? (i > 3 ? t['taMin'+(i-1)] : undefined);
                        let maxT = t['taMax'+i] ?? (i > 3 ? t['taMax'+(i-1)] : undefined);
                        combinedData[i] = { min: minT, max: maxT, wf: wf, pop: pop };
                    }
                }
            } catch(e) { log('Mid API Error: ' + e.message); }

            let html = '';
            for(let i=0; i<=10; i++) {
                const d = new Date(yyyy, now.getMonth(), now.getDate() + i);
                const label = (d.getMonth()+1) + '/' + d.getDate();
                const w = combinedData[i] || { wf: '-', min: '-', max: '-', pop: '-' };
                
                const wf = w.wf || "-";
                let icon = 'â˜€ï¸';
                if(wf.includes('íë¦¼')) icon='â˜ï¸';
                else if(wf.includes('êµ¬ë¦„') || wf.includes('ë§ìŒ')) icon='â›…';
                else if(wf.includes('ë¹„')) icon='ğŸŒ§ï¸';
                else if(wf.includes('ëˆˆ')) icon='â„ï¸';

                const minT = (w.min !== undefined && w.min !== 100) ? w.min : '-';
                const maxT = (w.max !== undefined && w.max !== -100) ? w.max : '-';
                const pop = (w.pop !== undefined) ? w.pop : 0;

                html += `<div class="col"><div class="time">${label}<br><span style="font-size:9px; color:#aaa;">+${i}D</span></div><div class="icon">${icon}</div><div class="temp"><span class="high">${maxT}</span>/<span class="low">${minT}</span></div><div class="precip ${pop>0?'precip-blue':''}">${pop}%</div></div>`;
            }
            targetContainer.innerHTML += `<div class="weather-section"><div class="loc-info"><span class="loc-name">${loc.name}</span><span class="loc-sub">${loc.sub}</span></div><div class="grid weekly-grid">${html}</div></div>`;
        }
        statusSpan1.innerText = "";
        statusSpan2.innerText = "";
    }

    function initCCTV() {
        if(Hls.isSupported()) {
            const streams = [
                { id: 'v1', url: 'http://211.114.96.121:1935/jejusi7/11-24.stream/playlist.m3u8' },
                { id: 'v2', url: 'http://119.65.216.155:1935/live/cctv03.stream_360p/playlist.m3u8' },
                { id: 'v3', url: 'http://119.65.216.155:1935/live/cctv05.stream_360p/playlist.m3u8' } 
            ];
            streams.forEach(s => {
                const video = document.getElementById(s.id);
                if(video) {
                    const hls = new Hls();
                    hls.loadSource(s.url);
                    hls.attachMedia(video);
                }
            });
        }
    }
    
    async function initHallasan() {
        log("Start initHallasan (Robust Mode)");
        const container = document.getElementById('hallasan-list');
        const statusSpan = document.getElementById('hallasan-status');
        if(!container) return;

        const dataUrl = 'https://jeju.go.kr/tool/hallasan/road-body.jsp';
        const mainUrl = 'https://jeju.go.kr/hallasan/index.htm';
        const proxyBase = 'https://api.allorigins.win/raw?url=';
        
        let res;
        let usedSource = 'Direct';

        try {
            // [1ì°¨ ì‹œë„] ì§ì ‘ í˜¸ì¶œ (road-body.jsp)
            log("Trying 1st (Direct): " + dataUrl);
            res = await fetch(dataUrl);
            if (!res.ok) throw new Error("Direct fetch failed: " + res.status);
            usedSource = 'Direct Body';

        } catch (e1) {
            log("1st failed: " + e1.message);
            
            // [2ì°¨ ì‹œë„] í”„ë¡ì‹œ í˜¸ì¶œ (road-body.jsp)
            try {
                const proxyUrl = proxyBase + encodeURIComponent(dataUrl);
                log("Trying 2nd (Proxy Body): " + proxyUrl);
                res = await fetch(proxyUrl);
                if (!res.ok) throw new Error("Proxy body failed: " + res.status);
                usedSource = 'Proxy Body';
            } catch (e2) {
                log("2nd failed: " + e2.message);

                // [3ì°¨ ì‹œë„] ë©”ì¸ í˜ì´ì§€ í”„ë¡ì‹œ í˜¸ì¶œ (index.htm)
                try {
                    const mainProxyUrl = proxyBase + encodeURIComponent(mainUrl);
                    log("Trying 3rd (Proxy Main): " + mainProxyUrl);
                    res = await fetch(mainProxyUrl);
                    if (!res.ok) throw new Error("All sources failed");
                    usedSource = 'Proxy Main';
                } catch (e3) {
                    log("3rd failed: " + e3.message);
                    container.innerHTML = `
                        <div style="padding:20px; text-align:center; color:#f44336; font-size:12px;">
                            <div style="margin-bottom:10px;">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                            <div style="font-size:10px; color:#999; margin-bottom:15px;">(${e3.message})</div>
                            <a href="https://jeju.go.kr/hallasan/index.htm" target="_blank" 
                               style="display:inline-block; padding:12px 25px; background:#333; color:white; text-decoration:none; border-radius:8px; font-weight:bold;">
                               ğŸŒ í•œë¼ì‚° ê³µì‹ í™ˆí˜ì´ì§€ ì´ë™
                            </a>
                        </div>
                    `;
                    if(statusSpan) statusSpan.innerText = "Error";
                    return;
                }
            }
        }
            
        // ì‘ë‹µ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° ë””ì½”ë”©
        let text = '';
        try {
            const contentType = res.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                const json = await res.json();
                text = (typeof json === 'string') ? json : JSON.stringify(json);
            } else {
                const buffer = await res.arrayBuffer();
                let decoder = new TextDecoder('utf-8');
                text = decoder.decode(buffer);
                if (text.includes('charset=euc-kr') || text.includes('charset=EUC-KR')) {
                    decoder = new TextDecoder('euc-kr');
                    text = decoder.decode(buffer);
                }
            }
        } catch (parseErr) {
            log("Text decoding failed: " + parseErr.message);
            return;
        }

        // DOM íŒŒì‹±
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');
        
        const trails = [
            { id: 'ì–´ë¦¬ëª©', name: 'å¾¡é‡Œç‰§ (Eorimok)' },
            { id: 'ì˜ì‹¤', name: 'çµå®¤ (Yeongsil)' },
            { id: 'ì–´ìŠ¹ìƒì•…', name: 'å¾¡ä¹˜ç”Ÿå²³ (Eoseungsaengak)' },
                            { id: 'ëˆë‚´ì½”', name: 'é¡¿ä¹ƒå…‹ (Donnaeko)' },
                            { id: 'ì„êµ´ì•”', name: 'çŸ³çªŸåºµ (Seokgulam)' },
                            { id: 'ê´€ìŒì‚¬', name: 'è§‚éŸ³å¯º (Gwaneumsa)' },            { id: 'ì„±íŒì•…', name: 'åŸæ¿å²³ (Seongpanak)' }
        ];

        const getStatusCN = (st) => {
            if(st === 'ì •ìƒ') return { t:'ğŸŸ¢ æ­£å¸¸è¿è¥', c:'#4caf50' }; 
            if(st === 'ë¶€ë¶„') return { t:'ğŸŸ¡ éƒ¨åˆ†ç®¡åˆ¶', c:'#ff9800' };
            if(st === 'í†µì œ') return { t:'ğŸ”´ å…¨é¢ç®¡åˆ¶', c:'#f44336' }; 
            return { t:'âšª ä¿¡æ¯æœªçŸ¥', c:'#999' }; 
        };

        const statusMap = {}; 
        
        // ìŠ¤í¬ë˜í•‘ ë¡œì§: .main-visit-list (ê³µí†µ)
        const dlList = doc.querySelectorAll('.main-visit-list');

        trails.forEach(t => {
            let st = 'í™•ì¸ë¶ˆê°€';
            const keyword = t.id.trim();
            
            let targetDl = null;
            for(let dl of dlList) {
                if(dl.textContent.includes(keyword)) {
                    targetDl = dl;
                    break;
                }
            }

            if (targetDl) {
                const situationDd = targetDl.querySelector('.situation');
                const statusText = situationDd ? situationDd.textContent : targetDl.textContent;
                
                if (statusText.includes('ì •ìƒ')) st = 'ì •ìƒ';
                else if (statusText.includes('í†µì œ')) st = 'í†µì œ';
                else if (statusText.includes('ë¶€ë¶„')) st = 'ë¶€ë¶„';
            }
            statusMap[t.id] = getStatusCN(st);
        });

        // ë Œë”ë§
        let html = '<div class="grid" style="gap:10px; margin-bottom:15px; display:block;">'; 
        
        trails.forEach(t => {
            const info = statusMap[t.id] || getStatusCN('í™•ì¸ë¶ˆê°€');
            html += `
                <div style="width:100%; background:#f8f9fa; padding:12px 15px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #e9ecef; box-sizing:border-box; margin-bottom: 8px;">
                    <span style="font-weight:800; font-size:13px; color:#2d3436; flex:1;">${t.name}</span>
                    <span style="font-size:11px; font-weight:bold; color:${info.c}; background:${info.c}15; padding:4px 10px; border-radius:20px; border:1px solid ${info.c}30; white-space:nowrap;">${info.t}</span>
                </div>
            `;
        });
        html += '</div>';

        html += `
            <div style="margin-top:5px; border-top:1px dashed #eee; padding-top:12px;">
                <a href="https://jeju.go.kr/hallasan/index.htm" target="_blank" 
                   style="display:flex; align-items:center; justify-content:center; gap:5px; width:100%; background:#4a69bd; color:white; text-decoration:none; 
                          padding:12px 0; border-radius:8px; text-align:center; font-weight:bold; font-size:13px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                    ğŸŒ è®¿é—®æ±‰æ‹¿å±±å®˜ç½‘
                </a>
            </div>
            <div style="text-align:center; font-size:9px; color:#ccc; margin-top:5px;">Source: ${usedSource}</div>
        `;

        container.innerHTML = html;
        if(statusSpan) statusSpan.innerText = "Updated";
    }

    // Init functions
    document.addEventListener('DOMContentLoaded', () => {
        initCCTV();
        initDaily();
        initWeekly();
        initHallasan();
    });
</script>
</body>
</html>