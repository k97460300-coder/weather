<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµå·å²›å¤©æ°” - è²æ´/ä¸­æ–‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body {
            margin: 0; padding: 10px; background-color: #f0f2f5;
            display: flex; flex-direction: column; align-items: center;
            font-family: 'Noto Sans SC', sans-serif; min-height: 100vh; color: #333;
        }
        .container { width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 40px; }
        .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .card-header {
            background: #fff; padding: 12px 15px; border-bottom: 1px solid #eee;
            font-weight: 800; font-size: 16px; color: #1a1a1a; display: flex; justify-content: space-between; align-items: center;
        }
        .badge { font-size: 11px; padding: 3px 8px; border-radius: 12px; background: #e8f5e9; color: #2e7d32; font-weight: bold; }

        /* CCTV Section */
        .video-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-bottom: 1px solid #222; }
        .live-tag { position: absolute; top: 10px; left: 10px; background: #ff5252; color: white; padding: 2px 6px; font-size: 10px; border-radius: 3px; z-index: 10; animation: blink 1.5s infinite; font-weight: bold; }
        .vid-label { position: absolute; bottom: 8px; left: 10px; color: white; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); z-index: 10; }
        video { width: 100%; height: 100%; object-fit: cover; }
        @keyframes blink { 0%, 100% {opacity: 1;} 50% {opacity: 0.6;} }

        /* Weather Section */
        .weather-section { padding: 15px; border-bottom: 8px solid #f0f2f5; }
        .weather-section:last-child { border-bottom: none; }
        .loc-info { margin-bottom: 12px; }
        .loc-name { font-size: 18px; font-weight: 900; color: #1a1a1a; }
        .loc-sub { font-size: 12px; color: #666; margin-left: 5px; font-weight: 500; }

        .grid { display: flex; flex-wrap: wrap; gap: 0; }
        .col {
            width: 14.28%; display: flex; flex-direction: column; align-items: center; margin-bottom: 12px;
        }
        /* Weekly 4 per row */
        .weekly-grid .col { width: 25%; margin-bottom: 18px; }

        .time { font-size: 11px; color: #757575; font-weight: bold; margin-bottom: 3px; }
        .icon { font-size: 22px; margin-bottom: 2px; }
        .temp { font-size: 14px; font-weight: 900; color: #212121; }
        .wind { font-size: 9px; color: #0288d1; font-weight: 600; margin-top: 1px; }
        .rain { font-size: 10px; color: #546e7a; font-weight: 500; }

        .high { color: #d32f2f; } .low { color: #1976d2; }
        .rain-blue { color: #1e88e5; font-weight: bold; }

        footer { text-align: center; padding: 20px; font-size: 11px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card" style="background:#000;">
            <div class="card-header" style="background:#ff5252; color:#fff; border:none;">ğŸ”´ æµå·å²›å®å†µ (Live CCTV)</div>
            <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸï¸ ç‰›å²› (Udo - å¤©æ´¥æ¸¯)</div><video id="v1" autoplay muted playsinline></video></div>
            <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸ”ï¸ æ±‰æ‹¿å±± (Mt.Halla - å¨åŠ¿å²³)</div><video id="v2" autoplay muted playsinline></video></div>
            <div class="video-box"><div class="live-tag">LIVE</div><div class="vid-label">ğŸ›£ï¸ 1100é«˜ì§€é“è·¯ (é›ªæ™¯)</div><video id="v3" autoplay muted playsinline></video></div>
        </div>

        <div class="card">
            <div class="card-header">â˜€ï¸ ä»Šæ—¥é€æ—¶é¢„æŠ¥ (09:00 - 22:00) <span class="badge" id="date-label"></span></div>
            <div id="daily-list">
                <div style="padding:40px; text-align:center; color:#999; font-size:14px;">æ­£åœ¨è·å–å®æ—¶å¤©æ°”æ•°æ®...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸ“… æœªæ¥10å¤©é•¿æœŸé¢„æŠ¥</div>
            <div id="weekly-list">
                <div style="padding:40px; text-align:center; color:#999; font-size:14px;">æ­£åœ¨è·å–é•¿æœŸé¢„æŠ¥æ•°æ®...</div>
            </div>
        </div>

        <footer>Data provided by Korea Meteorological Administration</footer>
    </div>

<script>
    const API_KEY = '05988a053767a7a6cc5553d077ce7ea541c60806a0160d5ac2e9119ebe5a61ce';
    const PROXY = 'https://api.allorigins.win/raw?url=';
    const now = new Date();
    const todayStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
    document.getElementById('date-label').innerText = `${now.getMonth()+1}æœˆ${now.getDate()}ì¼`;

    function initCCTV() {
        const streams = [
            { id: 'v1', url: 'http://211.114.96.121:1935/jejusi7/11-24.stream/chunklist_w1514884533.m3u8' },
            { id: 'v2', url: 'http://119.65.216.155:1935/live/cctv03.stream_360p/chunklist_w324217178.m3u8' },
            { id: 'v3', url: 'http://119.65.216.155:1935/live/cctv05.stream_360p/chunklist_w1064037964.m3u8' }
        ];
        if (Hls.isSupported()) {
            streams.forEach(s => {
                const v = document.getElementById(s.id);
                const h = new Hls(); h.loadSource(s.url); h.attachMedia(v);
                h.on(Hls.Events.ERROR, function(e,d){ if(d.fatal) h.startLoad(); });
            });
        }
    }

    async function initDaily() {
        const locs = [
            {n:"æµå·å¸‚ (è²æ´)", sub:"Yeon-dong", x:52, y:38},
            {n:"è¥¿å½’æµ¦ (ä¸­æ–‡)", sub:"Jungmun", x:52, y:32},
            {n:"æ±‰æ‹¿å±±", sub:"Mt.Halla", x:52, y:35},
            {n:"ç‰›å²›", sub:"Udo Island", x:60, y:38}
        ];
        const baseTime = now.getHours() < 2 ? "2300" : "0200";
        const baseDate = now.getHours() < 2 ? String(Number(todayStr)-1) : todayStr;
        const container = document.getElementById('daily-list');
        container.innerHTML = '';

        for (const loc of locs) {
            try {
                // ì¤„ë°”ê¿ˆìœ¼ë¡œ ì¸í•´ ëŠê¸´ URL ìˆ˜ì •
                const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${API_KEY}&numOfRows=400&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${loc.x}&ny=${loc.y}`;
                const res = await fetch(PROXY + encodeURIComponent(url));
                const json = await res.json();

                const hourly = {};
                json.response.body.items.item.forEach(i => {
                    if (i.fcstDate === todayStr) {
                        const h = parseInt(i.fcstTime.slice(0,2));
                        if(h>=9 && h<=22) {
                            if(!hourly[h]) hourly[h] = {};
                            hourly[h][i.category] = i.fcstValue;
                        }
                    }
                });

                let html = '';
                for(let h=9; h<=22; h++) {
                    const d = hourly[h];
                    if(d) {
                        let icon = 'â˜€ï¸';
                        const pty=parseInt(d.PTY||0), sky=parseInt(d.SKY||1);
                        if(pty>0) icon=(pty===3)?'â„ï¸':'ğŸŒ§ï¸'; else if(sky>8) icon='â˜ï¸'; else if(sky>5) icon='â›…';
                        if(h>=19 && (icon==='â˜€ï¸'||icon==='â›…')) icon='ğŸŒ™';
                        const pop = d.POP || 0;
                        html += `<div class="col">
                            <div class="time">${h}æ—¶</div>
                            <div class="icon">${icon}</div>
                            <div class="temp">${d.TMP}Â°</div>
                            <div class="wind">${d.WSD}m/s</div>
                            <div class="rain ${pop>0?'rain-blue':''}">${pop}%</div>
                        </div>`;
                    }
                }
                container.innerHTML += `<div class="weather-section">
                    <div class="loc-info"><span class="loc-name">${loc.n}</span><span class="loc-sub">${loc.sub}</span></div>
                    <div class="grid">${html}</div>
                </div>`;
            } catch(e) { }
        }
    }

    async function initWeekly() {
        const container = document.getElementById('weekly-list');
        const locs = [
            { name: "æµå·å¸‚", sub: "Jeju City", regIdTemp: '11G00201', regIdLand: '11G00000' },
            { name: "è¥¿å½’æµ¦", sub: "Seogwipo", regIdTemp: '11G00401', regIdLand: '11G00000' }
        ];

        const h = now.getHours();
        let midTmFc, dayShift = 0;
        if (h < 6) {
            const yD = new Date(now); yD.setDate(now.getDate() - 1);
            midTmFc = `${yD.getFullYear()}${String(yD.getMonth()+1).padStart(2,'0')}${String(yD.getDate()).padStart(2,'0')}1800`;
            dayShift = 1;
        } else if (h >= 18) { midTmFc = `${todayStr}1800`; }
        else { midTmFc = `${todayStr}0600`; }

        container.innerHTML = '';

        for (const loc of locs) {
            try {
                // ì¤„ë°”ê¿ˆìœ¼ë¡œ ì¸í•´ ëŠê¸´ URL ìˆ˜ì •
                const urlT = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidTa?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdTemp}&tmFc=${midTmFc}`;
                const resT = await fetch(PROXY + encodeURIComponent(urlT)); const jsonT = await resT.json();
                
                const urlL = `https://apis.data.go.kr/1360000/MidFcstInfoService/getMidLandFcst?serviceKey=${API_KEY}&numOfRows=1&pageNo=1&dataType=JSON&regId=${loc.regIdLand}&tmFc=${midTmFc}`;
                const resL = await fetch(PROXY + encodeURIComponent(urlL)); const jsonL = await resL.json();

                if(jsonT.response.header.resultCode === '00' && jsonL.response.header.resultCode === '00') {
                    const t = jsonT.response.body.items.item[0];
                    const l = jsonL.response.body.items.item[0];
                    let html = '';

                    for(let i=3; i<=10; i++) {
                        const k = i + dayShift; if(k>10) continue;
                        const d = new Date(now); d.setDate(now.getDate() + i);
                        const label = `${d.getMonth()+1}/${d.getDate()}`;

                        let wf = (k<=7) ? (l[`wf${k}Pm`]||l[`wf${k}`]) : l[`wf${k}`];
                        let icon = 'â˜€ï¸';
                        if(wf.includes('íë¦¼')) icon='â˜ï¸';
                        else if(wf.includes('êµ¬ë¦„')) icon='â›…';
                        else if(wf.includes('ë¹„')) icon='ğŸŒ§ï¸';

                        const min = t[`taMin${k}`]||t[`taMin${k}Low`]||'-';
                        const max = t[`taMax${k}`]||t[`taMax${k}High`]||'-';
                        const pop = (k<=7) ? (l[`rnSt${k}Pm`]||l[`rnSt${k}`]) : l[`rnSt${k}`];

                        html += `<div class="col">
                            <div class="time">${label}</div>
                            <div class="icon">${icon}</div>
                            <div class="temp"><span class="high">${max}</span>/<span class="low">${min}</span></div>
                            <div class="rain rain-blue">${pop}%</div>
                        </div>`;
                    }
                    container.innerHTML += `<div class="weather-section">
                        <div class="loc-info"><span class="loc-name">${loc.name}</span><span class="loc-sub">${loc.sub}</span></div>
                        <div class="grid weekly-grid">${html}</div>
                    </div>`;
                }
            } catch(e) { }
        }
    }

    initCCTV();
    initDaily();
    setTimeout(initWeekly, 2000);
</script>
</body>
</html>
